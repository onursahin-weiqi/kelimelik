<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Kelimelik</title>

<style>
body{
  font-family: Arial;
  text-align:center;
  background:#f4f4f4;
}

h1{
  font-size:48px;
}

#board{
  margin:20px auto;
  width:max-content;
}

.row{
  display:flex;
  justify-content:center;
}

.tile{
  width:55px;
  height:55px;
  margin:4px;
  font-size:24px;
  font-weight:bold;
  display:flex;
  justify-content:center;
  align-items:center;
  border-radius:6px;
  border:2px solid #ccc;
  background:white;
}

.correct{ background:#2e7d32; color:white; border:none; }
.present{ background:#f9a825; color:white; border:none; }
.absent{ background:#616161; color:white; border:none; }

#keyboard{
  margin-top:25px;
}

.key{
  padding:12px 14px;
  margin:3px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#ddd;
  cursor:pointer;
  transition: transform 0.08s ease;
}

.key:active{
  transform: scale(0.85);
}

.key.correct{ background:#2e7d32; color:white; }
.key.present{ background:#f9a825; color:white; }
.key.absent{ background:#bbb; color:#666; }

#popupOverlay{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.5);
  display:none;
  justify-content:center;
  align-items:center;
}

#popup{
  background:white;
  padding:30px;
  border-radius:15px;
  width:300px;
}

#shareBtn,#restartBtn{
  margin-top:12px;
  padding:12px;
  width:100%;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
}

#shareBtn{
  background:#388e3c;
  color:white;
}

#restartBtn{
  background:#1976d2;
  color:white;
}

</style>
</head>

<body>

<h1>Kelimelik</h1>

<div id="board"></div>
<div id="keyboard"></div>

<div id="popupOverlay">
  <div id="popup">
    <h2 id="popupMessage"></h2>

    <button id="shareBtn" onclick="shareResult()">
      ðŸ“¤ Sonucu PaylaÅŸ
    </button>

    <button id="restartBtn"></button>
  </div>
</div>

<script>

let wordList=[];
let target="";
let attempts=0;
let maxAttempts=6;
let currentGuess="";
let history=[];
let letterStates={};

const keyboardLayout=[
["Q","W","E","R","T","Y","U","I","O","P","Äž","Ãœ"],
["A","S","D","F","G","H","J","K","L","Åž","Ä°"],
["Z","X","C","V","B","N","M","Ã–","Ã‡"]
];

const VALID_LETTERS=[
"A","B","C","Ã‡","D","E","F","G","Äž","H",
"I","Ä°","J","K","L","M","N","O","Ã–","P",
"R","S","Åž","T","U","Ãœ","V","Y","Z"
];


// â­ TDK Kelime YÃ¼kle
async function loadWords(){

  try{
    const res=await fetch("https://sozluk.gov.tr/autocomplete.json");
    const data=await res.json();

    wordList=data
      .map(w=>w.madde.toUpperCase())
      .filter(w=>{
        return /^[A-ZÃ‡ÄžÄ°Ã–ÅžÃœ]+$/u.test(w) &&
               w.length===5;
      });

    startGame();

  }catch(e){

    // Fallback
    wordList=[
      "GÃ–REV","TAKIM","YAZIL","KODLA","BÄ°LGÄ°",
      "PROJE","PLANL","ZAMAN","AKTÄ°F","VERÄ°M"
    ];

    startGame();
  }
}


function startGame(){

  if(!wordList.length) return;

  target = wordList[Math.floor(Math.random()*wordList.length)];

  attempts=0;
  currentGuess="";
  history=[];
  letterStates={};

  document.getElementById("board").innerHTML="";
  document.getElementById("keyboard").innerHTML="";
  document.getElementById("popupOverlay").style.display="none";

  createBoard();
  createKeyboard();
}


function createBoard(){
  const board=document.getElementById("board");

  for(let r=0;r<6;r++){
    const row=document.createElement("div");
    row.className="row";

    for(let c=0;c<5;c++){
      const tile=document.createElement("div");
      tile.className="tile";
      row.appendChild(tile);
    }

    board.appendChild(row);
  }
}


function createKeyboard(){

  const kb=document.getElementById("keyboard");

  keyboardLayout.forEach(row=>{
    const rowDiv=document.createElement("div");

    row.forEach(letter=>{
      const btn=document.createElement("button");
      btn.innerText=letter;
      btn.className="key";
      btn.id="key-"+letter;

      btn.onclick=()=>{
        animateKey(btn);
        pressKey(letter);
      };

      rowDiv.appendChild(btn);
    });

    kb.appendChild(rowDiv);
  });
}


function animateKey(el){
  el.animate([
    {transform:"scale(1)"},
    {transform:"scale(0.85)"},
    {transform:"scale(1)"}
  ],{duration:120});
}


function pressKey(letter){
  if(currentGuess.length<5){
    currentGuess+=letter;
    updateBoard();
  }
}

function deleteLetter(){
  currentGuess=currentGuess.slice(0,-1);
  updateBoard();
}

function updateBoard(){
  const row=document.getElementById("board").children[attempts];

  for(let i=0;i<5;i++){
    row.children[i].innerText=currentGuess[i]||"";
  }
}


function checkGuess(){

  const result=Array(5).fill("absent");
  const targetLetters=target.split("");

  for(let i=0;i<5;i++){
    if(currentGuess[i]===target[i]){
      result[i]="correct";
      targetLetters[i]=null;
    }
  }

  for(let i=0;i<5;i++){
    if(result[i]==="correct") continue;

    const index=targetLetters.indexOf(currentGuess[i]);
    if(index!==-1){
      result[i]="present";
      targetLetters[index]=null;
    }
  }

  return result;
}


function submitGuess(){

  if(currentGuess.length!==5) return;

  const result=checkGuess();
  history.push(result);

  const row=document.getElementById("board").children[attempts];

  for(let i=0;i<5;i++){
    row.children[i].classList.add(result[i]);
  }

  updateKeyboard(currentGuess,result);

  if(currentGuess===target){
    endGame(true);
    return;
  }

  attempts++;
  currentGuess="";

  if(attempts===maxAttempts){
    endGame(false);
  }
}


function updateKeyboard(guess,result){

  for(let i=0;i<5;i++){

    const letter=guess[i];
    const state=result[i];

    if(letterStates[letter]==="correct") continue;
    if(letterStates[letter]==="present" && state==="absent") continue;

    letterStates[letter]=state;

    const key=document.getElementById("key-"+letter);

    if(key){
      key.classList.remove("correct","present","absent");
      key.classList.add(state);
    }
  }
}


function endGame(win){

  const popup=document.getElementById("popupOverlay");
  const msg=document.getElementById("popupMessage");
  const restartBtn=document.getElementById("restartBtn");

  popup.style.display="flex";

  msg.innerText=win
    ? "ðŸŽ‰ Tebrikler, doÄŸru bildin!"
    : "âŒ Bilemedin! Kelime: "+target;

  restartBtn.innerText=win
    ? "ðŸ†• Yeni Oyun BaÅŸlat"
    : "ðŸ”„ Tekrar Dene";

  restartBtn.onclick=win ? startGame : resumeGame;
}


function resumeGame(){
  startGame();
}


function shareResult(){

  let text=`Kelimelik ${history.length}/6\n`;

  history.forEach(row=>{
    row.forEach(cell=>{
      if(cell==="correct") text+="ðŸŸ©";
      else if(cell==="present") text+="ðŸŸ¨";
      else text+="â¬œ";
    });
    text+="\n";
  });

  navigator.clipboard.writeText(text);
  alert("Panoya kopyalandÄ±!");
}


document.addEventListener("keydown",(e)=>{

  const key=e.key.toUpperCase();

  if(key==="ENTER") submitGuess();
  else if(key==="BACKSPACE") deleteLetter();
  else if(VALID_LETTERS.includes(key)){
    const btn=document.getElementById("key-"+key);
    if(btn) animateKey(btn);
    pressKey(key);
  }
});


loadWords();

</script>

</body>
</html>
